/**
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE
 */
/**
 * Sync from @ant-design/colors(https://github.com/ant-design/ant-design-colors)
 */
import { rgbToHsv, rgbToHex, inputToRGB } from '@ctrl/tinycolor';
const hueStep = 2; // 色相阶梯
const saturationStep = 0.16; // 饱和度阶梯，浅色部分
const saturationStep2 = 0.05; // 饱和度阶梯，深色部分
const brightnessStep1 = 0.05; // 亮度阶梯，浅色部分
const brightnessStep2 = 0.15; // 亮度阶梯，深色部分
const lightColorCount = 5; // 浅色数量，主色上
const darkColorCount = 4; // 深色数量，主色下
// 暗色主题颜色映射关系表
const darkColorMap = [
    { index: 7, opacity: 0.15 },
    { index: 6, opacity: 0.25 },
    { index: 5, opacity: 0.3 },
    { index: 5, opacity: 0.45 },
    { index: 5, opacity: 0.65 },
    { index: 5, opacity: 0.85 },
    { index: 4, opacity: 0.9 },
    { index: 3, opacity: 0.95 },
    { index: 2, opacity: 0.97 },
    { index: 1, opacity: 0.98 }
];
// Wrapper function ported from TinyColor.prototype.toHsv
// Keep it here because of `hsv.h * 360`
function toHsv({ r, g, b }) {
    const hsv = rgbToHsv(r, g, b);
    return { h: hsv.h * 360, s: hsv.s, v: hsv.v };
}
// Wrapper function ported from TinyColor.prototype.toHexString
// Keep it here because of the prefix `#`
function toHex({ r, g, b }) {
    return `#${rgbToHex(r, g, b, false)}`;
}
// Wrapper function ported from TinyColor.prototype.mix, not treeshakable.
// Amount in range [0, 1]
// Assume color1 & color2 has no alpha, since the following src code did so.
function mix(rgb1, rgb2, amount) {
    const p = amount / 100;
    const rgb = {
        r: (rgb2.r - rgb1.r) * p + rgb1.r,
        g: (rgb2.g - rgb1.g) * p + rgb1.g,
        b: (rgb2.b - rgb1.b) * p + rgb1.b
    };
    return rgb;
}
function getHue(hsv, i, light) {
    let hue;
    // 根据色相不同，色相转向不同
    if (Math.round(hsv.h) >= 60 && Math.round(hsv.h) <= 240) {
        hue = light ? Math.round(hsv.h) - hueStep * i : Math.round(hsv.h) + hueStep * i;
    }
    else {
        hue = light ? Math.round(hsv.h) + hueStep * i : Math.round(hsv.h) - hueStep * i;
    }
    if (hue < 0) {
        hue += 360;
    }
    else if (hue >= 360) {
        hue -= 360;
    }
    return hue;
}
function getSaturation(hsv, i, light) {
    // grey color don't change saturation
    if (hsv.h === 0 && hsv.s === 0) {
        return hsv.s;
    }
    let saturation;
    if (light) {
        saturation = hsv.s - saturationStep * i;
    }
    else if (i === darkColorCount) {
        saturation = hsv.s + saturationStep;
    }
    else {
        saturation = hsv.s + saturationStep2 * i;
    }
    // 边界值修正
    if (saturation > 1) {
        saturation = 1;
    }
    // 第一格的 s 限制在 0.06-0.1 之间
    if (light && i === lightColorCount && saturation > 0.1) {
        saturation = 0.1;
    }
    if (saturation < 0.06) {
        saturation = 0.06;
    }
    return Number(saturation.toFixed(2));
}
function getValue(hsv, i, light) {
    let value;
    if (light) {
        value = hsv.v + brightnessStep1 * i;
    }
    else {
        value = hsv.v - brightnessStep2 * i;
    }
    if (value > 1) {
        value = 1;
    }
    return Number(value.toFixed(2));
}
export function generate(color, opts = {}) {
    const patterns = [];
    const pColor = inputToRGB(color);
    for (let i = lightColorCount; i > 0; i -= 1) {
        const hsv = toHsv(pColor);
        const colorString = toHex(inputToRGB({
            h: getHue(hsv, i, true),
            s: getSaturation(hsv, i, true),
            v: getValue(hsv, i, true)
        }));
        patterns.push(colorString);
    }
    patterns.push(toHex(pColor));
    for (let i = 1; i <= darkColorCount; i += 1) {
        const hsv = toHsv(pColor);
        const colorString = toHex(inputToRGB({
            h: getHue(hsv, i),
            s: getSaturation(hsv, i),
            v: getValue(hsv, i)
        }));
        patterns.push(colorString);
    }
    // dark theme patterns
    if (opts.theme === 'dark') {
        return darkColorMap.map(({ index, opacity }) => {
            const darkColorString = toHex(mix(inputToRGB(opts.backgroundColor || '#141414'), inputToRGB(patterns[index]), opacity * 100));
            return darkColorString;
        });
    }
    return patterns;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb21wb25lbnRzL2NvcmUvY29sb3IvZ2VuZXJhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBRUg7O0dBRUc7QUFFSCxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVqRSxNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPO0FBQzFCLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxDQUFDLGFBQWE7QUFDMUMsTUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLENBQUMsYUFBYTtBQUMzQyxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsQ0FBQyxZQUFZO0FBQzFDLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxDQUFDLFlBQVk7QUFDMUMsTUFBTSxlQUFlLEdBQUcsQ0FBQyxDQUFDLENBQUMsV0FBVztBQUN0QyxNQUFNLGNBQWMsR0FBRyxDQUFDLENBQUMsQ0FBQyxXQUFXO0FBQ3JDLGNBQWM7QUFDZCxNQUFNLFlBQVksR0FBRztJQUNuQixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRTtJQUMzQixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRTtJQUMzQixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRTtJQUMxQixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRTtJQUMzQixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRTtJQUMzQixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRTtJQUMzQixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRTtJQUMxQixF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QUFHLENBQUMsRUFBRSxDQUFDLElBQUksY0FBYyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUM1QyxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUIsTUFBTSxXQUFXLEdBQVcsS0FBSyxDQUMvQixVQUFVLENBQUM7WUFDVCxDQUFDLEVBQUUsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDakIsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQ3hCLENBQUMsRUFBRSxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztTQUNwQixDQUFDLENBQ0gsQ0FBQztRQUNGLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELHNCQUFzQjtJQUN0QixJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssTUFBTSxFQUFFLENBQUM7UUFDMUIsT0FBTyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRTtZQUM3QyxNQUFNLGVBQWUsR0FBVyxLQUFLLENBQ25DLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGVBQWUsSUFBSSxTQUFTLENBQUMsRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsT0FBTyxHQUFHLEdBQUcsQ0FBQyxDQUMvRixDQUFDO1lBQ0YsT0FBTyxlQUFlLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0QsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9naXRodWIuY29tL05HLVpPUlJPL25nLXpvcnJvLWFudGQvYmxvYi9tYXN0ZXIvTElDRU5TRVxuICovXG5cbi8qKlxuICogU3luYyBmcm9tIEBhbnQtZGVzaWduL2NvbG9ycyhodHRwczovL2dpdGh1Yi5jb20vYW50LWRlc2lnbi9hbnQtZGVzaWduLWNvbG9ycylcbiAqL1xuXG5pbXBvcnQgeyByZ2JUb0hzdiwgcmdiVG9IZXgsIGlucHV0VG9SR0IgfSBmcm9tICdAY3RybC90aW55Y29sb3InO1xuXG5jb25zdCBodWVTdGVwID0gMjsgLy8g6Imy55u46Zi25qKvXG5jb25zdCBzYXR1cmF0aW9uU3RlcCA9IDAuMTY7IC8vIOmlseWSjOW6pumYtuair++8jOa1heiJsumDqOWIhlxuY29uc3Qgc2F0dXJhdGlvblN0ZXAyID0gMC4wNTsgLy8g6aWx5ZKM5bqm6Zi25qKv77yM5rex6Imy6YOo5YiGXG5jb25zdCBicmlnaHRuZXNzU3RlcDEgPSAwLjA1OyAvLyDkuq7luqbpmLbmoq/vvIzmtYXoibLpg6jliIZcbmNvbnN0IGJyaWdodG5lc3NTdGVwMiA9IDAuMTU7IC8vIOS6ruW6pumYtuair++8jOa3seiJsumDqOWIhlxuY29uc3QgbGlnaHRDb2xvckNvdW50ID0gNTsgLy8g5rWF6Imy5pWw6YeP77yM5Li76Imy5LiKXG5jb25zdCBkYXJrQ29sb3JDb3VudCA9IDQ7IC8vIOa3seiJsuaVsOmHj++8jOS4u+iJsuS4i1xuLy8g5pqX6Imy5Li76aKY6aKc6Imy5pig5bCE5YWz57O76KGoXG5jb25zdCBkYXJrQ29sb3JNYXAgPSBbXG4gIHsgaW5kZXg6IDcsIG9wYWNpdHk6IDAuMTUgfSxcbiAgeyBpbmRleDogNiwgb3BhY2l0eTogMC4yNSB9LFxuICB7IGluZGV4OiA1LCBvcGFjaXR5OiAwLjMgfSxcbiAgeyBpbmRleDogNSwgb3BhY2l0eTogMC40NSB9LFxuICB7IGluZGV4OiA1LCBvcGFjaXR5OiAwLjY1IH0sXG4gIHsgaW5kZXg6IDUsIG9wYWNpdHk6IDAuODUgfSxcbiAgeyBpbmRleDogNCwgb3BhY2l0eTogMC45IH0sXG4gIHsgaW5kZXg6IDMsIG9wYWNpdHk6IDAuOTUgfSxcbiAgeyBpbmRleDogMiwgb3BhY2l0eTogMC45NyB9LFxuICB7IGluZGV4OiAxLCBvcGFjaXR5OiAwLjk4IH1cbl07XG5cbmludGVyZmFjZSBIc3ZPYmplY3Qge1xuICBoOiBudW1iZXI7XG4gIHM6IG51bWJlcjtcbiAgdjogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgUmdiT2JqZWN0IHtcbiAgcjogbnVtYmVyO1xuICBnOiBudW1iZXI7XG4gIGI6IG51bWJlcjtcbn1cblxuLy8gV3JhcHBlciBmdW5jdGlvbiBwb3J0ZWQgZnJvbSBUaW55Q29sb3IucHJvdG90eXBlLnRvSHN2XG4vLyBLZWVwIGl0IGhlcmUgYmVjYXVzZSBvZiBgaHN2LmggKiAzNjBgXG5mdW5jdGlvbiB0b0hzdih7IHIsIGcsIGIgfTogUmdiT2JqZWN0KTogSHN2T2JqZWN0IHtcbiAgY29uc3QgaHN2ID0gcmdiVG9Ic3YociwgZywgYik7XG4gIHJldHVybiB7IGg6IGhzdi5oICogMzYwLCBzOiBoc3YucywgdjogaHN2LnYgfTtcbn1cblxuLy8gV3JhcHBlciBmdW5jdGlvbiBwb3J0ZWQgZnJvbSBUaW55Q29sb3IucHJvdG90eXBlLnRvSGV4U3RyaW5nXG4vLyBLZWVwIGl0IGhlcmUgYmVjYXVzZSBvZiB0aGUgcHJlZml4IGAjYFxuZnVuY3Rpb24gdG9IZXgoeyByLCBnLCBiIH06IFJnYk9iamVjdCk6IHN0cmluZyB7XG4gIHJldHVybiBgIyR7cmdiVG9IZXgociwgZywgYiwgZmFsc2UpfWA7XG59XG5cbi8vIFdyYXBwZXIgZnVuY3Rpb24gcG9ydGVkIGZyb20gVGlueUNvbG9yLnByb3RvdHlwZS5taXgsIG5vdCB0cmVlc2hha2FibGUuXG4vLyBBbW91bnQgaW4gcmFuZ2UgWzAsIDFdXG4vLyBBc3N1bWUgY29sb3IxICYgY29sb3IyIGhhcyBubyBhbHBoYSwgc2luY2UgdGhlIGZvbGxvd2luZyBzcmMgY29kZSBkaWQgc28uXG5mdW5jdGlvbiBtaXgocmdiMTogUmdiT2JqZWN0LCByZ2IyOiBSZ2JPYmplY3QsIGFtb3VudDogbnVtYmVyKTogUmdiT2JqZWN0IHtcbiAgY29uc3QgcCA9IGFtb3VudCAvIDEwMDtcbiAgY29uc3QgcmdiID0ge1xuICAgIHI6IChyZ2IyLnIgLSByZ2IxLnIpICogcCArIHJnYjEucixcbiAgICBnOiAocmdiMi5nIC0gcmdiMS5nKSAqIHAgKyByZ2IxLmcsXG4gICAgYjogKHJnYjIuYiAtIHJnYjEuYikgKiBwICsgcmdiMS5iXG4gIH07XG4gIHJldHVybiByZ2I7XG59XG5cbmZ1bmN0aW9uIGdldEh1ZShoc3Y6IEhzdk9iamVjdCwgaTogbnVtYmVyLCBsaWdodD86IGJvb2xlYW4pOiBudW1iZXIge1xuICBsZXQgaHVlOiBudW1iZXI7XG4gIC8vIOagueaNruiJsuebuOS4jeWQjO+8jOiJsuebuOi9rOWQkeS4jeWQjFxuICBpZiAoTWF0aC5yb3VuZChoc3YuaCkgPj0gNjAgJiYgTWF0aC5yb3VuZChoc3YuaCkgPD0gMjQwKSB7XG4gICAgaHVlID0gbGlnaHQgPyBNYXRoLnJvdW5kKGhzdi5oKSAtIGh1ZVN0ZXAgKiBpIDogTWF0aC5yb3VuZChoc3YuaCkgKyBodWVTdGVwICogaTtcbiAgfSBlbHNlIHtcbiAgICBodWUgPSBsaWdodCA/IE1hdGgucm91bmQoaHN2LmgpICsgaHVlU3RlcCAqIGkgOiBNYXRoLnJvdW5kKGhzdi5oKSAtIGh1ZVN0ZXAgKiBpO1xuICB9XG4gIGlmIChodWUgPCAwKSB7XG4gICAgaHVlICs9IDM2MDtcbiAgfSBlbHNlIGlmIChodWUgPj0gMzYwKSB7XG4gICAgaHVlIC09IDM2MDtcbiAgfVxuICByZXR1cm4gaHVlO1xufVxuXG5mdW5jdGlvbiBnZXRTYXR1cmF0aW9uKGhzdjogSHN2T2JqZWN0LCBpOiBudW1iZXIsIGxpZ2h0PzogYm9vbGVhbik6IG51bWJlciB7XG4gIC8vIGdyZXkgY29sb3IgZG9uJ3QgY2hhbmdlIHNhdHVyYXRpb25cbiAgaWYgKGhzdi5oID09PSAwICYmIGhzdi5zID09PSAwKSB7XG4gICAgcmV0dXJuIGhzdi5zO1xuICB9XG4gIGxldCBzYXR1cmF0aW9uOiBudW1iZXI7XG4gIGlmIChsaWdodCkge1xuICAgIHNhdHVyYXRpb24gPSBoc3YucyAtIHNhdHVyYXRpb25TdGVwICogaTtcbiAgfSBlbHNlIGlmIChpID09PSBkYXJrQ29sb3JDb3VudCkge1xuICAgIHNhdHVyYXRpb24gPSBoc3YucyArIHNhdHVyYXRpb25TdGVwO1xuICB9IGVsc2Uge1xuICAgIHNhdHVyYXRpb24gPSBoc3YucyArIHNhdHVyYXRpb25TdGVwMiAqIGk7XG4gIH1cbiAgLy8g6L6555WM5YC85L+u5q2jXG4gIGlmIChzYXR1cmF0aW9uID4gMSkge1xuICAgIHNhdHVyYXRpb24gPSAxO1xuICB9XG4gIC8vIOesrOS4gOagvOeahCBzIOmZkOWItuWcqCAwLjA2LTAuMSDkuYvpl7RcbiAgaWYgKGxpZ2h0ICYmIGkgPT09IGxpZ2h0Q29sb3JDb3VudCAmJiBzYXR1cmF0aW9uID4gMC4xKSB7XG4gICAgc2F0dXJhdGlvbiA9IDAuMTtcbiAgfVxuICBpZiAoc2F0dXJhdGlvbiA8IDAuMDYpIHtcbiAgICBzYXR1cmF0aW9uID0gMC4wNjtcbiAgfVxuICByZXR1cm4gTnVtYmVyKHNhdHVyYXRpb24udG9GaXhlZCgyKSk7XG59XG5cbmZ1bmN0aW9uIGdldFZhbHVlKGhzdjogSHN2T2JqZWN0LCBpOiBudW1iZXIsIGxpZ2h0PzogYm9vbGVhbik6IG51bWJlciB7XG4gIGxldCB2YWx1ZTogbnVtYmVyO1xuICBpZiAobGlnaHQpIHtcbiAgICB2YWx1ZSA9IGhzdi52ICsgYnJpZ2h0bmVzc1N0ZXAxICogaTtcbiAgfSBlbHNlIHtcbiAgICB2YWx1ZSA9IGhzdi52IC0gYnJpZ2h0bmVzc1N0ZXAyICogaTtcbiAgfVxuICBpZiAodmFsdWUgPiAxKSB7XG4gICAgdmFsdWUgPSAxO1xuICB9XG4gIHJldHVybiBOdW1iZXIodmFsdWUudG9GaXhlZCgyKSk7XG59XG5cbmludGVyZmFjZSBPcHRzIHtcbiAgdGhlbWU/OiAnZGFyaycgfCAnZGVmYXVsdCc7XG4gIGJhY2tncm91bmRDb2xvcj86IHN0cmluZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlKGNvbG9yOiBzdHJpbmcsIG9wdHM6IE9wdHMgPSB7fSk6IHN0cmluZ1tdIHtcbiAgY29uc3QgcGF0dGVybnM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IHBDb2xvciA9IGlucHV0VG9SR0IoY29sb3IpO1xuICBmb3IgKGxldCBpID0gbGlnaHRDb2xvckNvdW50OyBpID4gMDsgaSAtPSAxKSB7XG4gICAgY29uc3QgaHN2ID0gdG9Ic3YocENvbG9yKTtcbiAgICBjb25zdCBjb2xvclN0cmluZzogc3RyaW5nID0gdG9IZXgoXG4gICAgICBpbnB1dFRvUkdCKHtcbiAgICAgICAgaDogZ2V0SHVlKGhzdiwgaSwgdHJ1ZSksXG4gICAgICAgIHM6IGdldFNhdHVyYXRpb24oaHN2LCBpLCB0cnVlKSxcbiAgICAgICAgdjogZ2V0VmFsdWUoaHN2LCBpLCB0cnVlKVxuICAgICAgfSlcbiAgICApO1xuICAgIHBhdHRlcm5zLnB1c2goY29sb3JTdHJpbmcpO1xuICB9XG4gIHBhdHRlcm5zLnB1c2godG9IZXgocENvbG9yKSk7XG4gIGZvciAobGV0IGkgPSAxOyBpIDw9IGRhcmtDb2xvckNvdW50OyBpICs9IDEpIHtcbiAgICBjb25zdCBoc3YgPSB0b0hzdihwQ29sb3IpO1xuICAgIGNvbnN0IGNvbG9yU3RyaW5nOiBzdHJpbmcgPSB0b0hleChcbiAgICAgIGlucHV0VG9SR0Ioe1xuICAgICAgICBoOiBnZXRIdWUoaHN2LCBpKSxcbiAgICAgICAgczogZ2V0U2F0dXJhdGlvbihoc3YsIGkpLFxuICAgICAgICB2OiBnZXRWYWx1ZShoc3YsIGkpXG4gICAgICB9KVxuICAgICk7XG4gICAgcGF0dGVybnMucHVzaChjb2xvclN0cmluZyk7XG4gIH1cblxuICAvLyBkYXJrIHRoZW1lIHBhdHRlcm5zXG4gIGlmIChvcHRzLnRoZW1lID09PSAnZGFyaycpIHtcbiAgICByZXR1cm4gZGFya0NvbG9yTWFwLm1hcCgoeyBpbmRleCwgb3BhY2l0eSB9KSA9PiB7XG4gICAgICBjb25zdCBkYXJrQ29sb3JTdHJpbmc6IHN0cmluZyA9IHRvSGV4KFxuICAgICAgICBtaXgoaW5wdXRUb1JHQihvcHRzLmJhY2tncm91bmRDb2xvciB8fCAnIzE0MTQxNCcpLCBpbnB1dFRvUkdCKHBhdHRlcm5zW2luZGV4XSksIG9wYWNpdHkgKiAxMDApXG4gICAgICApO1xuICAgICAgcmV0dXJuIGRhcmtDb2xvclN0cmluZztcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcGF0dGVybnM7XG59XG4iXX0=